@tailwind base;
@tailwind components;
@tailwind utilities;

/* Critical Above-the-Fold CSS - Optimized for Core Web Vitals */
@layer base {
  /* Prevent layout shifts with consistent sizing */
  html {
    scroll-behavior: smooth;
  }
  
  /* Critical font loading with optimized fallbacks */
  @font-face {
    font-family: 'Geist-fallback';
    src: local('system-ui'), local('-apple-system'), local('Segoe UI');
    size-adjust: 105%;
    ascent-override: 90%;
    descent-override: 22%;
    line-gap-override: normal;
    font-display: swap;
  }

  /* Prevent CLS with proper root layout */
  #__next {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    contain: layout style paint;
  }

  /* Critical image optimization */
  img, video {
    max-width: 100%;
    height: auto;
    content-visibility: auto;
    contain-intrinsic-size: 1px 300px;
  }

  /* Optimize skeleton loading for better perceived performance */
  .img-skeleton {
    background: linear-gradient(90deg, #f8fafc 0%, #e2e8f0 50%, #f8fafc 100%);
    background-size: 200% 100%;
    animation: loading 1.2s ease-in-out infinite;
    will-change: background-position;
    transform: translateZ(0); /* Force hardware acceleration */
  }

  @keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* Optimize LCP elements */
  .lcp-priority {
    content-visibility: auto;
    contain-intrinsic-size: 1px 400px;
  }
}

@layer utilities {
  /* Hardware-accelerated transitions */
  .critical-visible {
    @apply visible opacity-100 translate-y-0;
    transform: translate3d(0, 0, 0);
  }

  .critical-hidden {
    @apply invisible opacity-0 translate-y-1;
    transform: translate3d(0, 4px, 0);
  }

  /* Optimized fade animation */
  .preload-fade-in {
    animation: preload-fade 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  @keyframes preload-fade {
    0% { 
      opacity: 0; 
      transform: translate3d(0, 8px, 0);
    }
    100% { 
      opacity: 1; 
      transform: translate3d(0, 0, 0);
    }
  }
}

@layer components {
  /* Optimized quiz option with better performance */
  .quiz-option {
    @apply relative overflow-hidden p-4 sm:p-6 mb-3 sm:mb-4 text-left rounded-lg sm:rounded-xl;
    @apply bg-white/90 backdrop-blur-sm border border-gray-200/60;
    @apply transition-colors duration-200 ease-out;
    @apply shadow-sm hover:shadow-md;
    @apply hover:border-blue-400 hover:bg-white;
    @apply cursor-pointer;
    contain: layout style;
    will-change: border-color, background-color, box-shadow;
  }

  .quiz-option::before {
    content: '';
    @apply absolute left-0 top-0 h-full w-1 bg-transparent;
    @apply transition-colors duration-200;
    will-change: background-color;
  }

  .quiz-option:hover::before {
    @apply bg-blue-400;
  }

  /* Optimized answer states */
  .correct-answer {
    @apply bg-green-50 border-green-400 text-green-800;
    @apply shadow-sm;
  }

  .incorrect-answer {
    @apply bg-red-50 border-red-300 text-red-800;
  }

  .selected-option {
    @apply border-blue-400 bg-blue-50/60;
    @apply ring-1 ring-blue-200;
  }
  
  .feedback-icon {
    @apply ml-2 inline-block;
  }

  /* Optimized category cards */
  .category-card {
    @apply relative overflow-hidden rounded-xl sm:rounded-2xl p-4 sm:p-6;
    @apply bg-white/90 backdrop-blur-sm border border-white/30;
    @apply shadow-md hover:shadow-lg transition-shadow duration-300;
    @apply transform hover:-translate-y-1;
    contain: layout style;
    will-change: transform, box-shadow;
  }

  .category-card:hover {
    transform: translate3d(0, -4px, 0);
  }

  .category-image {
    @apply w-full h-24 sm:h-32 object-cover rounded-lg sm:rounded-xl mb-3 sm:mb-4;
    @apply transition-transform duration-300;
    contain: layout;
    will-change: transform;
  }

  .category-card:hover .category-image {
    transform: scale3d(1.02, 1.02, 1);
  }

  /* Optimized buttons */
  .btn {
    @apply px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-medium;
    @apply transition-colors duration-200;
    @apply focus:outline-none focus:ring-2 focus:ring-offset-2;
    contain: layout style;
    will-change: background-color, color;
  }

  .btn.primary {
    @apply bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500;
  }

  .btn.secondary {
    @apply bg-purple-600 text-white hover:bg-purple-700 focus:ring-purple-500;
  }

  .btn.tertiary {
    @apply bg-yellow-500 text-gray-800 hover:bg-yellow-600 focus:ring-yellow-500;
  }
}

/* Optimized animations with reduced motion support */
@keyframes fadeIn {
  0% { 
    opacity: 0; 
    transform: translate3d(0, 4px, 0);
  }
  100% { 
    opacity: 1; 
    transform: translate3d(0, 0, 0);
  }
}

.feedback-animate {
  animation: fadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Reduced confetti animation for better performance */
@keyframes confetti {
  0% { 
    transform: translate3d(0, 0, 0) rotate(0deg); 
    opacity: 1; 
  }
  100% { 
    transform: translate3d(0, -50vh, 0) rotate(180deg); 
    opacity: 0; 
  }
}

.animate-confetti {
  animation: confetti 0.8s linear forwards;
  will-change: transform, opacity;
}

/* Mobile-first responsive optimizations */
@media (max-width: 640px) {
  .quiz-container {
    padding: 1rem;
  }
  
  .categories-grid {
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 0.75rem;
  }
  
  .category-card {
    padding: 0.75rem;
  }
  
  .quiz-option {
    padding: 1rem;
    margin-bottom: 0.75rem;
  }

  /* Optimize mobile header */
  .quiz-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.75rem;
  }

  .quiz-header > div {
    width: 100%;
    justify-content: space-between;
  }

  .quiz-attributes {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    margin-bottom: 0.5rem;
  }

  .question-counter {
    margin-top: 0.5rem;
    width: 100%;
    text-align: left;
  }
}

/* Tablet optimizations */
@media (min-width: 641px) and (max-width: 1024px) {
  .categories-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
  }
}

/* Accessibility and performance optimizations */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .img-skeleton {
    animation: none;
    background: #f1f5f9;
  }
}

/* Improve tap targets for mobile */
@media (max-width: 768px) {
  button, 
  a,
  .quiz-option {
    min-height: 44px;
    min-width: 44px;
  }
}

/* High contrast focus styles */
:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

/* Prevent CLS for ads */
ins.adsbygoogle[data-ad-status="unfilled"] {
  display: none !important;
}

/* Performance optimizations for large screens */
@media (min-width: 1200px) {
  .category-card {
    contain: strict;
  }
  
  .quiz-option {
    contain: layout style;
  }
}

/* Print styles optimization */
@media print {
  .quiz-option,
  .category-card,
  .btn {
    break-inside: avoid;
  }
}